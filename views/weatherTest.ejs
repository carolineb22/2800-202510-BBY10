<%- include("templates/header") %>
<h1>Weather Info</h1>
<p id="weather">Fetching weather...</p>
<p id="cords">fetching cords...</p>
<div id="puter-message">Generating advice based on weather...</div>


<script src="https://js.puter.com/v2/"></script>

<script>
navigator.geolocation.getCurrentPosition(success, error);

function success(position) {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    console.log(`Latitude: ${latitude}, Longitude: ${longitude}`);
    getWeather(latitude, longitude);
}

function error() {
    console.error("Unable to retrieve your location");
}

function getWeather(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=<%= apiKey%>`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log("Weather Data:", data);
            const temp = data.main.temp;
            const description = data.weather[0].description;
            document.getElementById("weather").textContent = `Temperature: ${temp}°C, ${description}`;
            document.getElementById("cords").textContent = `Latitude: ${lat}, Longitude: ${lon}`;
            
            const weatherSummary = `The current temperature is ${temp}°C with ${description}.`;
            generatePuterMessage(weatherSummary);
        })
        .catch(err => console.error("Weather API error:", err));
}

function generatePuterMessage(weatherInfo) {
    const prompt = `Based on the weather report: "${weatherInfo}", give a friendly message or advice for someone deciding what to do today. Dont inclue any aditonal questions as the ure wont be able to ask them.`;

    document.getElementById("puter-message").textContent = "Thinking...";

    puter.ai.chat(prompt)
      .then(response => {
        document.getElementById("puter-message").textContent = response;
        console.log("Puter message:", response);
      })
      .catch(err => {
        console.error("Puter SDK error:", err);
        document.getElementById("puter-message").textContent = "Could not fetch AI message.";
      });
  }

</script>
<%- include("templates/footer") %>